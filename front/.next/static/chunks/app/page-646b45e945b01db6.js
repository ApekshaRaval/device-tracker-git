(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5489:function(e,t,o){Promise.resolve().then(o.bind(o,1969))},1969:function(e,t,o){"use strict";o.r(t);var n=o(7437),r=o(5783),i=o(4891),l=o(6289),a=o(1326),s=o(511),c=o(9959),u=o(6463),d=o(2265),f=o(3684),p=o(920),m=o(6482),g=o(4962),h=o(7105),x=o(8797);let v=(0,i.Z)(l.Z)(e=>{let{theme:t}=e;return{"& .MuiInputBase-input::placeholder":{color:"black !important",opacity:.9,fontFamily:"cursive",fontSize:"1rem"}}});t.default=()=>{let[e,t]=(0,d.useState)(""),[o,i]=(0,d.useState)(null),[l,S]=(0,d.useState)(null),{socket:y,users:b,setUsers:j}=(0,r.s)(),w=(0,p.Z)(),{position:E}=(0,m.Z)(),[k,Z]=(0,d.useState)(null),C=(0,u.useRouter)(),P=async()=>{if(!e||!l){g.ZP.error("All fields are required");return}let t=new FormData;t.append("id",w),t.append("name",e),t.append("lat",E[0]),t.append("lang",E[1]),t.append("profilePic",l);try{let e=await fetch("".concat(x.i,"/add-user"),{method:"POST",body:t}),o=await e.json();if((null==o?void 0:o.status)===200){let e=null==o?void 0:o.data;y.emit("add-user",{id:null==e?void 0:e.id,name:null==e?void 0:e.name,lat:E[0],lang:E[1],profilePic:null==e?void 0:e.profile_pic}),localStorage.setItem("user",JSON.stringify({id:null==e?void 0:e.id,name:null==e?void 0:e.name,lat:E[0],lang:E[1],profilePic:null==e?void 0:e.profile_pic})),await D(),g.ZP.success("Welcome ".concat(null==e?void 0:e.name," \uD83E\uDD70!"),{duration:2e3,position:"top-right"}),C.push("/map")}else g.ZP.error(null==o?void 0:o.message,{duration:2e3,position:"top-right"})}catch(e){console.error("Error adding user:",e)}};(0,d.useEffect)(()=>{Z(JSON.parse(localStorage.getItem("user")))},[]);let D=async()=>{try{let e=await fetch("".concat(x.i,"/users")),t=await e.json();j(null==t?void 0:t.data)}catch(e){console.error("Error fetching user data:",e)}};(0,d.useEffect)(()=>{k&&C.push("/map")},[k]);let _=e=>{let t=e.target.files[0];S(t),i(URL.createObjectURL(t))};return(0,n.jsxs)(a.Z,{"data-aos":"fade-up",component:"form",sx:{"& > :not(style)":{m:1,width:{xs:"100%",md:"40ch"}},display:"flex",flexDirection:"column",alignItems:"center",mt:{xs:"7rem",md:"15rem"},backgroundImage:'url("https://img.freepik.com/premium-photo/white-flowers-background_853558-41364.jpg")',borderRadius:"5px",backdropFilter:"blur(5px)",width:{xs:"90%",md:"50%",lg:"40%"},mx:"auto",p:3},noValidate:!0,autoComplete:"off",children:[(0,n.jsx)(s.Z,{sx:{textAlign:"center",fontFamily:"cursive",fontSize:"1.5rem"},children:"World of map \uD83C\uDF0D"}),(0,n.jsx)(v,{id:"name-input",variant:"filled",placeholder:"Enter your name",value:e,onChange:e=>t(e.target.value)}),(0,n.jsx)(a.Z,{sx:{display:"flex",alignItems:"center",cursor:"pointer",justifyContent:"center",backgroundColor:"#d6dae0",borderRadius:"5px",p:2},children:o?(0,n.jsxs)(a.Z,{sx:{position:"relative"},children:[(0,n.jsx)(h.Z,{fontSize:"inherit",onClick:()=>{i(null),S(null)},sx:{position:"absolute",top:"-14px",right:"-14px",fontSize:"2rem",color:"#0E74D0"}}),(0,n.jsx)("img",{src:o,alt:"Preview",width:"150px",height:"150px"})]}):(0,n.jsx)("label",{htmlFor:"file-input",children:(0,n.jsxs)(s.Z,{sx:{fontFamily:"cursive",fontSize:"1rem"},children:[(0,n.jsx)(f.Z,{sx:{fontSize:"2rem",color:"#0E74D0"}})," Upload Profile Picture"]})})}),(0,n.jsx)(v,{type:"file",sx:{display:"none"},id:"file-input",placeholder:"Upload your profile picture",onChange:e=>_(e)}),(0,n.jsx)(c.Z,{variant:"contained",color:"primary",sx:{mt:3,fontFamily:"cursive",fontSize:"1.22rem",textTransform:"none"},onClick:P,"data-aos":"flip-left","data-aos-easing":"ease-out-cubic","data-aos-duration":"2000",children:"Start"})]})}},8797:function(e,t,o){"use strict";o.d(t,{i:function(){return n}});let n="https://device-tracker-git-1yuy.vercel.app"},5783:function(e,t,o){"use strict";o.d(t,{s:function(){return s}});var n=o(7437),r=o(8797),i=o(2265),l=o(4999);let a=(0,i.createContext)(),s=()=>(0,i.useContext)(a);t.Z=e=>{let{children:t}=e,[o,s]=(0,i.useState)(null),[c,u]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=(0,l.io)(r.i,{transports:["websocket"],withCredentials:!0});return s(e),e.on("connect",()=>{console.log("WebSocket connection established")}),e.on("disconnect",()=>{console.log("WebSocket connection closed")}),e.on("error",e=>{console.error("WebSocket error:",e)}),()=>e.close()},[]);let d=async()=>{try{let e=await fetch("".concat(r.i,"/users")),t=await e.json();u(null==t?void 0:t.data)}catch(e){console.error("Error fetching user data:",e)}};return(0,i.useEffect)(()=>{o&&d()},[o]),(0,n.jsx)(a.Provider,{value:{socket:o,users:c,setUsers:u},children:t})}},6482:function(e,t,o){"use strict";var n=o(7437),r=o(5783),i=o(2265);t.Z=()=>{let{socket:e,users:t}=(0,r.s)(),[o,l]=(0,i.useState)(null),[a,s]=(0,i.useState)([51.505,-.09]);return((0,i.useEffect)(()=>{l(JSON.parse(localStorage.getItem("user")))},[]),(0,i.useEffect)(()=>{let t;return e&&navigator.geolocation&&(t=navigator.geolocation.watchPosition(t=>{let n=[t.coords.latitude,t.coords.longitude];if(e.emit("send-location",{id:null==o?void 0:o.id,lat:n[0],lang:n[1]}),s(n),o){let e={...o,lat:n[0],lang:n[1]};localStorage.setItem("user",JSON.stringify(e)),l(e)}},e=>{console.error("Error getting location",e)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})),()=>{navigator.geolocation&&void 0!==t&&navigator.geolocation.clearWatch(t),e&&e.off("send-location")}},[e]),(0,i.useEffect)(()=>{if(e){let t=e=>{s([null==e?void 0:e.lat,null==e?void 0:e.lang])};return e.on("location",t),()=>{e.off("location",t)}}},[e]),o)?{position:a,users:t,setPosition:s}:(0,n.jsx)("div",{children:"loading.."})}}},function(e){e.O(0,[263,943,953,971,23,744],function(){return e(e.s=5489)}),_N_E=e.O()}]);